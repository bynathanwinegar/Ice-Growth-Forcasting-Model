const updateForecastCardsAndChart = (weatherData) => {
    const groupSize = getGroupSize();
    const groupedData = [];
    for (let i = 0; i < weatherData.length; i += groupSize) {
        const group = weatherData.slice(i, i + groupSize);
        groupedData.push(group);
    }

    forecastCards.innerHTML = groupedData.map(group => `
        <div class="glider-slide">
            ${group.map(data => `
                <div class="hour-box">
                    <h3>${data.day} ${data.time}:00</h3>
                    <p>Temperature: ${isMetric ? fahrenheitToCelsius(data.temperature) + ' 째C' : data.temperature + ' 째F'}</p>
                    <p>Wind Speed: ${isMetric ? mphToMs(parseFloat(data.windSpeed)) + ' m/s' : data.windSpeed}</p>
                    <p>Relative Humidity: ${data.relativeHumidity}%</p>
                    <p>Probability of Precipitation: ${data.probabilityOfPrecipitation}%</p>
                    <p>${data.potentialIceGrowth}</p>
                    <p>Total Ice Thickness: ${data.totalIceThickness}</p>
                </div>
            `).join('')}
        </div>
    `).join('');

    const glider = new Glider(document.querySelector('.glider'), {
        slidesToShow: 1,
        slidesToScroll: 1,
        draggable: true,
        dots: '.dots',
        arrows: {
            prev: '.glider-prev',
            next: '.glider-next'
        },
        responsive: [
            {
                breakpoint: 768,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 2
                }
            },
            {
                breakpoint: 1024,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 3
                }
            }
        ]
    });

    const labels = weatherData.map(data => `${data.day} ${data.time}:00`);
    const temperatures = weatherData.map(data => isMetric ? fahrenheitToCelsius(data.temperature) : data.temperature);
    const windSpeeds = weatherData.map(data => isMetric ? mphToMs(parseFloat(data.windSpeed)) : data.windSpeed);
    const humidities = weatherData.map(data => data.relativeHumidity);
    const precipitations = weatherData.map(data => data.probabilityOfPrecipitation);
    const iceGrowth = weatherData.map(data => parseFloat(data.potentialIceGrowth.replace(' mm/hr', '').replace(' inches/hr', '')));
    const totalIceThicknesses = weatherData.map(data => parseFloat(data.totalIceThickness.replace(' mm', '').replace(' inches', '')));

    if (weatherChart) {
        weatherChart.destroy();
    }

    const ctx = document.getElementById('weatherChart').getContext('2d');
    weatherChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: `Potential Ice Growth (${isMetric ? 'mm/hr' : 'inches/hr'})`,
                    data: iceGrowth,
                    borderColor: 'rgba(0, 0, 0, 1)',
                    backgroundColor: 'rgba(0, 0, 0, 0.2)',
                    fill: true,
                },
                {
                    label: `Total Ice Thickness (${isMetric ? 'mm' : 'inches'})`,
                    data: totalIceThicknesses,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    fill: true,
                },
                {
                    label: `Temperature (${isMetric ? '째C' : '째F'})`,
                    data: temperatures,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    fill: true,
                },
                {
                    label: `Wind Speed (${isMetric ? 'm/s' : 'mph'})`,
                    data: windSpeeds,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    fill: true,
                },
                {
                    label: 'Relative Humidity (%)',
                    data: humidities,
                    borderColor: 'rgba(153, 102, 255, 1)',
                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                    fill: true,
                },
                {
                    label: 'Probability of Precipitation (%)',
                    data: precipitations,
                    borderColor: 'rgba(255, 159, 64, 1)',
                    backgroundColor: 'rgba(255, 159, 64, 0.2)',
                    fill: true,
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: true,
                },
            },
        },
    });
};

window.addEventListener('resize', updateForecastCardsAndChart);
